<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5" style="max-width: 400px">
      <h2 class="mb-3">Sign Up</h2>
      {% with messages=get_flashed_messages()%} {% if messages%} 
      {% for message in messages%}
      <p>{{message}}</p>
      {%endfor%} {%endif%} {%endwith%}
      <form action="checkdetails" id="form" method="post">
        <input type="text" style="display: none" value="0" name="role" />
        <div class="mb-3">
          <label class="form-label">Name</label>
          <input type="text" class="form-control" name="name" />
          <p class="m-1 text-danger fw-bold"></p>
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" name="email" required />
          <p class="m-1 text-danger fw-bold"></p>
        </div>
        <div class="mb-3">
          <label class="form-label">Password</label>
          <input
            type="password"
            class="form-control"
            name="password"
            required
          />
          <p class="m-1 text-danger fw-bold"></p>
        </div>
        <a href="login">Already registerd login Here!</a>
        <button type="submit" class="btn btn-primary w-100 mt-2">
          Sign Up
        </button>
      </form>
    </div>
    <script>
      let form = document.getElementById("form");
      let inputs = document.querySelectorAll(".form-control");
      let errors = document.querySelectorAll("form p");

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        let valid = input_validations();
        if (valid) {
          form.submit();
        }
      });

      function input_validations() {
        let allvalid = true;
        inputs.forEach((x, i) => {
          errors[i].textContent = "";
          if (x.name == "name") {
            if (x.value.trim() == "") {
              errors[i].textContent = "Input is empty";
              allvalid = false;
            }
          }

          if (x.name == "email") {
            if (!email_validation(x.value, i)) {
              allvalid = false;
            }
          }
          if (x.name == "password") {
            if (!password_validation(x.value, i)) {
              allvalid = false;
            }
          }
        });
        return allvalid;
      }

      function email_validation(email, index) {
        let emailCheck = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.(com|in)$/.test(
          email
        );
        if (email.trim() == "") {
          errors[index].textContent = "Email field is empty";
          return false;
        }
        if (!emailCheck) {
          errors[index].textContent = "Email is invalid";
          return false;
        }
        return true;
      }

      function password_validation(password, index) {
        let specialchar = /[@.#$!%^&*.?]/g.test(password);
        if (password.trim() == "") {
          errors[index].textContent = "Password is empty";
          return false;
        }
        if (!specialchar) {
          errors[index].textContent = "Password is invalid";
          return false;
        }
        if (password.length < 6) {
          errors[index].textContent = "Password length is short";
          return false;
        }
        return true;
      }
    </script>
  </body>
</html>
